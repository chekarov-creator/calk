<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Калькулятор ПТМ + расход — инженерный обогрев</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="wrap">
  <h1>Калькулятор ПТМ + расход (инженерный периметр)</h1>
  <div class="sub">Расчет приведенной толщины металла (ПТМ) и расхода огнезащитных материалов. Выберите профиль и укажите обогреваемые стороны, кликая по сегментам периметра на схеме. Обогреваемые стороны выделяются оранжевым цветом. Периметр P рассчитывается автоматически на основе выбранных сторон.</div>

  <div class="card">
    <div class="row">
      <label>
        <div class="lbl">Расход на 1 мм (кг/м²)</div>
        <input id="ratePerMm" type="number" step="0.001" min="0" value="1.00"/>
      </label>
      <label>
        <div class="lbl">Толщина по умолчанию (мм)</div>
        <input id="defaultThickness" type="number" step="0.01" min="0" value="1.00"/>
      </label>
      <label>
        <div class="lbl">Ед. количества по умолчанию</div>
        <select id="defaultQtyUnit">
          <option value="m" selected>метры (пог. м)</option>
          <option value="t">тонны (т)</option>
        </select>
      </label>
      <label>
        <div class="lbl">Примечание</div>
        <div class="mini">CSV теперь скачивается в UTF‑8 с BOM (Excel открывает без “крякозябр”). PDF использует встроенный шрифт с кириллицей.</div>
      </label>
    </div>

    <div class="toolbar">
      <button id="btnAdd" class="btn" type="button">+ Добавить строку</button>
      <button id="btnCalcAll" class="btn secondary" type="button">Пересчитать всё</button>
      <button id="btnCsv" class="btn secondary" type="button">Экспорт CSV</button>
      <button id="btnXlsx" class="btn secondary" type="button">Экспорт Excel</button>
      <button id="btnPdf" class="btn secondary" type="button">Экспорт PDF</button>
      <button id="btnClear" class="btn secondary" type="button">Очистить</button>
      <span id="err" class="err"></span>
      <span id="ok" class="ok"></span>
    </div>

    <div style="overflow:auto;">
      <table>
        <thead>
          <tr>
            <th style="min-width:160px;"></th>
            <th style="min-width:180px;"></th>
            <th style="min-width:260px;"></th>
            <th style="min-width:320px;" colspan="1">
              <div class="heat-hint">
                <div class="heat-hint-title">Выбор обогрева</div>
                <div class="heat-hint-content">
                  <p><span class="heat-hint-accent">Оранжевый = обогреваемая сторона</span></p>
                  <p><strong>Кликните по сторонам для выбора</strong></p>
                  <p>Обогреваемый периметр <strong>P</strong> рассчитывается автоматически. При необходимости можно ввести P вручную (будет иметь приоритет).</p>
                </div>
              </div>
            </th>
            <th style="min-width:90px;"></th>
            <th style="min-width:90px;"></th>
            <th style="min-width:100px;"></th>
            <th style="min-width:140px;"></th>
            <th style="min-width:110px;"></th>
            <th style="min-width:110px;"></th>
            <th style="min-width:120px;"></th>
            <th style="min-width:120px;"></th>
            <th style="min-width:140px;"></th>
            <th style="min-width:150px;"></th>
            <th style="min-width:90px;"></th>
          </tr>
          <tr>
            <th style="min-width:160px;">Тип</th>
            <th style="min-width:180px;">ГОСТ</th>
            <th style="min-width:260px;">Типоразмер (поиск)</th>
            <th style="min-width:320px;">Обогрев (сегменты) / P</th>
            <th style="min-width:90px;">S (см²)</th>
            <th style="min-width:90px;">P (см)</th>
            <th style="min-width:100px;">ПТМ (мм)</th>
            <th style="min-width:140px;">Предел огнестойкости</th>
            <th style="min-width:110px;">Площадь/м (м²)</th>
            <th style="min-width:110px;">Площадь/т (м²)</th>
            <th style="min-width:120px;">Толщина (мм)</th>
            <th style="min-width:120px;">Расход (кг/м²)</th>
            <th style="min-width:140px;">Количество</th>
            <th style="min-width:150px;">Итого (кг)</th>
            <th style="min-width:90px;"></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="note"><b>Подсказка:</b> для профильной трубы и листа — клик по сторонам; для трубы круглой — по дугам; для двутавра/швеллера/уголка — клик по сегментам периметра. Если нужно нестандартное примыкание — можно вручную задать P.</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js"></script>

<script type="module" src="js/app.js"></script>
</body>
</html>
